<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Maximum Reality Pets</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #222; /* Fallback color */
      background-image: url('bg_wp.jpg');
      background-size: cover;
      background-position: center;
      color: #fff;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }

    /* Container for both Creation and Stats in Top Right */
    .ui-container {
      position: absolute;
      top: env(safe-area-inset-top, 20px); /* Respects the iPhone Dynamic Island */
      right: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 10;
      width: 180px;
    }

    .panel {
      background-color: rgba(0, 0, 0, 0.7);
      padding: 12px;
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(5px);
    }

    .stats-box { font-size: 13px; line-height: 1.5; }
    
    .controls input, .controls select, .controls button {
      width: 100%;
      margin-bottom: 5px;
      padding: 8px;
      border-radius: 8px;
      border: none;
      box-sizing: border-box;
      font-size: 14px;
    }

    .controls button {
      background-color: #ffcc00;
      font-weight: bold;
      cursor: pointer;
    }

    /* The Pet & Animations */
    .pet-wrapper {
      position: absolute;
      transform-origin: bottom center;
      /* Gentle floating/breathing animation */
      animation: idleBob 3s ease-in-out infinite;
      z-index: 5;
    }

    .pet {
      width: 200px; /* Sized for iPhone screen */
      height: auto;
      image-rendering: pixelated;
      /* The Glow Effect */
      filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.6));
    }

    @keyframes idleBob {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-15px) scale(1.02); }
    }

    .food {
      position: absolute;
      font-size: 40px;
      z-index: 10;
      animation: floatUp 1s ease-out forwards;
    }

    @keyframes floatUp {
      0% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(-100px) rotate(20deg); opacity: 0; }
    }
  </style>
</head>
<body>

  <div class="ui-container">
    <div class="panel controls">
      <input id="petName" placeholder="Pet Name">
      <select id="petSpecies">
        <option value="cat">Cat</option>
        <option value="dragon">Dragon</option>
        <option value="frog">Frog</option>
        <option value="bunny">Bunny</option>
        <option value="unicorn">Unicorn</option>
        <option value="fox">Fox</option>
        <option value="dog">Dog</option>
      </select>
      <button onclick="createPet()">Create Pet</button>
      <button onclick="feedPet()" style="background: #00ffcc;">Feed Pet</button>
    </div>

    <div class="panel stats-box" id="statsBox">
      <div id="statName"><b>Name:</b> ‚Äî</div>
      <div id="statSpecies"><b>Species:</b> ‚Äî</div>
      <div id="statHunger"><b>Hunger:</b> ‚Äî</div>
      <div id="statHappiness"><b>Happiness:</b> ‚Äî</div>
      <div id="statHealth"><b>Health:</b> ‚Äî</div>
    </div>
  </div>

  <div id="game-world"></div>

  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDkpW7RAmX0wPmL757_GzEFIoU6snssLnA",
      authDomain: "pets-86c25.firebaseapp.com",
      projectId: "pets-86c25",
      storageBucket: "pets-86c25.firebasestorage.app",
      messagingSenderId: "556129222317",
      appId: "1:556129222317:web:12d323a5165eb222d59024"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const speciesSprites = { bunny: "bunny.png", frog: "frog.png", fox: "fox.png", cat: "cat.png", dragon: "dragon.png", unicorn: "unicorn.png", dog: "dog.png" };
    const foodIcons = { bunny: "ü•ï", frog: "ü™∞", fox: "üçî", cat: "üê†", dragon: "üçñ", unicorn: "üçé", dog: "ü•©" };

    let currentPet = null;

    async function fetchPets() {
      const snapshot = await db.collection("pets").orderBy("lastUpdated", "desc").limit(1).get();
      if (!snapshot.empty) {
        const data = snapshot.docs[0].data();
        displayPet({ id: snapshot.docs[0].id, ...data });
      }
    }

    function displayPet(pet) {
      currentPet = pet;
      const world = document.getElementById("game-world");
      world.innerHTML = ""; // Clear old pet

      const wrapper = document.createElement("div");
      wrapper.className = "pet-wrapper";
      wrapper.style.left = "25%"; // Centered horizontally for mobile
      wrapper.style.bottom = "20%"; // Placed on the "ground"

      const img = document.createElement("img");
      img.src = pet.sprite;
      img.className = "pet";
      
      wrapper.appendChild(img);
      world.appendChild(wrapper);
      updateStats();
    }

    function updateStats() {
      if (!currentPet) return;
      document.getElementById("statName").innerHTML = `<b>Name:</b> ${currentPet.name}`;
      document.getElementById("statSpecies").innerHTML = `<b>Species:</b> ${currentPet.species}`;
      document.getElementById("statHunger").innerText = `Hunger: ${Math.round(currentPet.stats.hunger)}`;
      document.getElementById("statHappiness").innerText = `Happiness: ${Math.round(currentPet.stats.happiness)}`;
      document.getElementById("statHealth").innerText = `Health: ${Math.round(currentPet.stats.health)}`;
    }

    async function createPet() {
      const name = document.getElementById("petName").value;
      const species = document.getElementById("petSpecies").value;
      if (!name) return alert("Give your pet a name!");

      const pet = {
        name,
        species,
        sprite: speciesSprites[species],
        stats: { hunger: 50, happiness: 50, energy: 50, health: 100 },
        lastUpdated: Date.now()
      };

      const ref = await db.collection("pets").add(pet);
      displayPet({ id: ref.id, ...pet });
    }

    async function feedPet() {
      if (!currentPet) return;
      
      // Update local logic
      currentPet.stats.hunger = Math.max(0, currentPet.stats.hunger - 15);
      currentPet.stats.happiness = Math.min(100, currentPet.stats.happiness + 5);

      // Update Firebase
      await db.collection("pets").doc(currentPet.id).update({
        stats: currentPet.stats,
        lastUpdated: Date.now()
      });

      updateStats();
      showFood();
    }

    function showFood() {
      const icon = foodIcons[currentPet.species];
      const food = document.createElement("div");
      food.className = "food";
      food.innerText = icon;
      food.style.left = "40%";
      food.style.bottom = "40%";
      document.body.appendChild(food);
      setTimeout(() => food.remove(), 1000);
    }

    fetchPets();
  </script>
</body>
</html>
