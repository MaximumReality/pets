<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Reality Pets Pro</title>
  <style>
    :root { --glass: rgba(0, 0, 0, 0.8); --gold: #ffcc00; }
    
    body {
      margin: 0; font-family: -apple-system, sans-serif;
      background: #1a1a1a url('bg_wp.jpg') no-repeat center center fixed;
      background-size: cover; color: #fff; overflow: hidden; height: 100vh;
    }

    /* Compact Stats - Top Right */
    .stats-mini {
      position: absolute; top: env(safe-area-inset-top, 20px); right: 10px;
      background: var(--glass); padding: 10px; border-radius: 12px;
      font-size: 11px; z-index: 100; backdrop-filter: blur(5px);
    }

    /* Collapsible Creation Menu - Top Left */
    .menu-wrap {
      position: absolute; top: env(safe-area-inset-top, 20px); left: 10px; z-index: 101;
    }
    #createMenu {
      display: none; background: var(--glass); padding: 10px; 
      border-radius: 12px; margin-top: 5px; width: 140px;
    }
    .gear-btn { background: var(--glass); border: none; font-size: 20px; border-radius: 50%; padding: 5px 8px; cursor: pointer; }

    /* Bottom Action Bar - Very Slim */
    .action-bar {
      position: absolute; bottom: env(safe-area-inset-bottom, 20px);
      left: 50%; transform: translateX(-50%);
      display: flex; gap: 8px; z-index: 100;
    }
    .action-bar button {
      background: var(--glass); border: 1px solid rgba(255,255,255,0.2);
      color: white; border-radius: 12px; padding: 10px; font-size: 18px;
    }

    /* Pet Rendering */
    .pet-stage {
      position: absolute; left: 50%; bottom: 30%;
      transform: translateX(-50%); transition: all 0.5s ease;
    }
    .pet-img {
      width: 100px; /* Starting size */
      filter: drop-shadow(0 0 15px rgba(255,255,255,0.3));
      animation: float 3s ease-in-out infinite;
      cursor: pointer;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .pop { position: absolute; font-size: 30px; animation: popUp 1s forwards; pointer-events: none; }
    @keyframes popUp { 0% { opacity: 1; } 100% { transform: translateY(-80px); opacity: 0; } }
  </style>
</head>
<body onclick="handleGlobalClick(event)">

  <div class="menu-wrap">
    <button class="gear-btn" onclick="toggleMenu(event)">‚öôÔ∏è</button>
    <div id="createMenu">
      <input id="petName" placeholder="Name" style="width:100%; margin-bottom:5px;">
      <select id="petSpecies" style="width:100%; margin-bottom:5px;">
        <option value="bunny">Bunny</option>
        <option value="fox">Fox</option>
        <option value="dog">Dog</option>
        <option value="dragon">Dragon</option>
        <option value="cat">Cat</option>
        <option value="unicorn">Unicorn</option>
        <option value="frog">Frog</option>
      </select>
      <button onclick="createPet()" style="width:100%; background:var(--gold); border:none; border-radius:5px;">Adopt</button>
    </div>
  </div>

  <div class="stats-mini" id="statsBox">
    <div id="sn"><b>‚Äî</b></div>
    <div id="sh">Hunger: ‚Äî</div>
    <div id="se">Energy: ‚Äî</div>
    <div id="sl">Level: 1</div>
  </div>

  <div id="game-world" class="pet-stage"></div>

  <div class="action-bar">
    <button onclick="feedPet()">üçé</button>
    <button onclick="cleanPet()">üßΩ</button>
    <button onclick="playPet()">‚öΩÔ∏è</button>
    <button id="sleepBtn" onclick="toggleSleep()">üåô</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDkpW7RAmX0wPmL757_GzEFIoU6snssLnA",
      authDomain: "pets-86c25.firebaseapp.com",
      projectId: "pets-86c25",
      storageBucket: "pets-86c25.firebasestorage.app",
      messagingSenderId: "556129222317",
      appId: "1:556129222317:web:12d323a5165eb222d59024"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let pet = null;
    let isSleeping = false;
    const foodMap = { bunny:"ü•ï", fox:"üçî", dog:"ü•©", dragon:"üçñ", cat:"üê†", unicorn:"üçé", frog:"ü™∞" };

    function toggleMenu(e) { e.stopPropagation(); const m = document.getElementById('createMenu'); m.style.display = m.style.display === 'block' ? 'none' : 'block'; }
    
    // Petting Logic: Click the pet to show love
    function handleGlobalClick(e) {
      if (e.target.classList.contains('pet-img') && !isSleeping) {
        pet.stats.happiness = Math.min(100, (pet.stats.happiness || 50) + 5);
        pet.stats.xp = (pet.stats.xp || 0) + 10;
        checkGrowth();
        spawnEffect("üíï", e.clientX, e.clientY);
        save();
      }
    }

    async function fetchPet() {
      const snap = await db.collection("pets").orderBy("lastUpdated", "desc").limit(1).get();
      if (!snap.empty) display({ id: snap.docs[0].id, ...snap.docs[0].data() });
    }

    function display(data) {
      pet = data;
      if (!pet.stats.level) pet.stats.level = 1;
      if (!pet.stats.xp) pet.stats.xp = 0;
      
      const world = document.getElementById("game-world");
      // Scale based on level: Start 100px, add 10px per level
      const size = 100 + (pet.stats.level * 10);
      world.innerHTML = `<img src="${pet.species}.png" class="pet-img" style="width:${size}px">`;
      updateUI();
    }

    function checkGrowth() {
      if (pet.stats.xp >= 100) {
        pet.stats.level++;
        pet.stats.xp = 0;
        spawnEffect("‚¨ÜÔ∏è LEVEL UP!", window.innerWidth/2, window.innerHeight/2);
        display(pet); // Refresh size
      }
    }

    function updateUI() {
      if (!pet) return;
      document.getElementById("sn").innerHTML = `<b>${pet.name} (Lv.${pet.stats.level})</b>`;
      document.getElementById("sh").innerText = `Hunger: ${Math.round(pet.stats.hunger)}`;
      document.getElementById("se").innerText = `Energy: ${Math.round(pet.stats.energy)}`;
      document.getElementById("sl").innerText = `XP: ${pet.stats.xp}/100`;
    }

    function feedPet() { if(!pet || isSleeping) return; pet.stats.hunger = Math.max(0, pet.stats.hunger - 20); pet.stats.xp += 5; spawnEffect(foodMap[pet.species], 150, 400); checkGrowth(); save(); }
    function cleanPet() { if(!pet || isSleeping) return; pet.stats.health = Math.min(100, (pet.stats.health || 100) + 20); spawnEffect("ü´ß", 150, 400); save(); }
    function playPet() { if(!pet || isSleeping) return; pet.stats.energy = Math.max(0, pet.stats.energy - 15); pet.stats.xp += 15; spawnEffect("‚öΩÔ∏è", 150, 400); checkGrowth(); save(); }

    function toggleSleep() {
      isSleeping = !isSleeping;
      document.body.style.filter = isSleeping ? "brightness(0.4)" : "none";
      if(!isSleeping) save();
    }

    async function save() {
      await db.collection("pets").doc(pet.id).update({ stats: pet.stats, lastUpdated: Date.now() });
      updateUI();
    }

    function spawnEffect(txt, x, y) {
      const p = document.createElement("div"); p.className = "pop"; p.innerText = txt;
      p.style.left = x + "px"; p.style.top = y + "px";
      document.body.appendChild(p); setTimeout(() => p.remove(), 1000);
    }

    async function createPet() {
      const n = document.getElementById("petName").value;
      const s = document.getElementById("petSpecies").value;
      if (!n) return;
      const res = await db.collection("pets").add({
        name: n, species: s, lastUpdated: Date.now(),
        stats: { hunger: 50, energy: 50, health: 100, level: 1, xp: 0 }
      });
      display({ id: res.id, name: n, species: s, stats: { hunger:50, energy:50, health:100, level:1, xp:0 } });
      toggleMenu({stopPropagation:()=>{}});
    }

    fetchPet();
  </script>
</body>
</html>
