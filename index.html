<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Maximum Reality Pets</title>
  <style>
    :root {
      --panel-bg: rgba(0, 0, 0, 0.75);
      --accent: #ffcc00;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #1a1a1a url('bg_wp.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      overflow: hidden;
      height: 100vh;
      transition: filter 1.2s ease-in-out;
    }

    body.sleeping { filter: brightness(0.3) saturate(0.5); }

    /* UI Placement for iPhone 14 Pro Max */
    .ui-stack {
      position: absolute;
      top: env(safe-area-inset-top, 44px);
      right: 15px;
      width: 170px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 100;
    }

    .panel {
      background: var(--panel-bg);
      padding: 12px;
      border-radius: 18px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }

    h2 { margin: 0 0 8px 0; font-size: 16px; text-align: center; color: var(--accent); }

    .controls input, .controls select, .controls button {
      width: 100%;
      margin-bottom: 6px;
      padding: 10px;
      border-radius: 10px;
      border: none;
      font-size: 14px;
      box-sizing: border-box;
    }

    .btn-feed { background: #4cd964; color: #000; font-weight: bold; }
    .btn-sleep { background: #5856d6; color: #fff; font-weight: bold; }
    .btn-clean { background: #5ac8fa; color: #000; font-weight: bold; }
    .btn-create { background: var(--accent); color: #000; font-weight: bold; }

    .stats-text { font-size: 13px; line-height: 1.6; }
    .stats-text b { color: var(--accent); }

    /* Pet & Glow */
    .pet-container {
      position: absolute;
      left: 50%;
      bottom: 20%;
      transform: translateX(-50%);
      z-index: 10;
      text-align: center;
    }

    .pet-img {
      width: 220px;
      height: auto;
      image-rendering: pixelated;
      filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.4));
      animation: breathe 4s ease-in-out infinite;
    }

    @keyframes breathe {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05) translateY(-10px); }
    }

    /* Effects */
    .particle {
      position: absolute;
      font-size: 40px;
      pointer-events: none;
      z-index: 50;
      animation: riseAndFade 1.5s ease-out forwards;
    }

    @keyframes riseAndFade {
      0% { transform: translateY(0) scale(0.5); opacity: 1; }
      100% { transform: translateY(-150px) scale(1.2); opacity: 0; }
    }
  </style>
</head>
<body>

  <div class="ui-stack">
    <div class="panel controls">
      <input id="petName" placeholder="Pet Name">
      <select id="petSpecies">
        <option value="bunny">Bunny (ü•ï)</option>
        <option value="fox">Fox (üçî)</option>
        <option value="dog">Dog (ü•©)</option>
        <option value="dragon">Dragon (üçñ)</option>
        <option value="cat">Cat (üê†)</option>
        <option value="unicorn">Unicorn (üçé)</option>
        <option value="frog">Frog (ü™∞)</option>
      </select>
      <button class="btn-create" onclick="createPet()">‚ú® Create</button>
    </div>

    <div class="panel stats-box" id="statsBox">
      <div class="stats-text" id="statName"><b>Name:</b> ‚Äî</div>
      <div class="stats-text" id="statHunger">Hunger: ‚Äî</div>
      <div class="stats-text" id="statEnergy">Energy: ‚Äî</div>
      <div class="stats-text" id="statHealth">Health: ‚Äî</div>
    </div>

    <div class="panel controls">
      <button class="btn-feed" onclick="feedPet()">üçé Feed</button>
      <button class="btn-clean" onclick="cleanPet()">üßº Wash</button>
      <button id="sleepBtn" class="btn-sleep" onclick="toggleSleep()">üåô Sleep</button>
    </div>
  </div>

  <div id="game-world" class="pet-container"></div>

  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDkpW7RAmX0wPmL757_GzEFIoU6snssLnA",
      authDomain: "pets-86c25.firebaseapp.com",
      projectId: "pets-86c25",
      storageBucket: "pets-86c25.firebasestorage.app",
      messagingSenderId: "556129222317",
      appId: "1:556129222317:web:12d323a5165eb222d59024"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentPet = null;
    let isSleeping = false;
    let sleepTimer = null;

    const foodMap = {
      bunny: "ü•ï", fox: "üçî", dog: "ü•©", dragon: "üçñ",
      cat: "üê†", unicorn: "üçé", frog: "ü™∞"
    };

    async function fetchPets() {
      const snap = await db.collection("pets").orderBy("lastUpdated", "desc").limit(1).get();
      if (!snap.empty) displayPet({ id: snap.docs[0].id, ...snap.docs[0].data() });
    }

    function displayPet(pet) {
      currentPet = pet;
      const world = document.getElementById("game-world");
      world.innerHTML = `<img src="${pet.species}.png" class="pet-img">`;
      updateStatsUI();
    }

    function updateStatsUI() {
      if (!currentPet) return;
      document.getElementById("statName").innerHTML = `<b>${currentPet.name}</b>`;
      document.getElementById("statHunger").innerText = `Hunger: ${Math.round(currentPet.stats.hunger)}`;
      document.getElementById("statEnergy").innerText = `Energy: ${Math.round(currentPet.stats.energy)}`;
      document.getElementById("statHealth").innerText = `Health: ${Math.round(currentPet.stats.health)}`;
    }

    async function feedPet() {
      if (!currentPet || isSleeping) return;
      currentPet.stats.hunger = Math.max(0, currentPet.stats.hunger - 15);
      spawnEffect(foodMap[currentPet.species] || "üçé");
      saveToFirebase();
    }

    async function cleanPet() {
      if (!currentPet || isSleeping) return;
      currentPet.stats.health = Math.min(100, currentPet.stats.health + 10);
      spawnEffect("üßº");
      saveToFirebase();
    }

    function toggleSleep() {
      if (!currentPet) return;
      isSleeping = !isSleeping;
      document.body.classList.toggle('sleeping', isSleeping);
      document.getElementById("sleepBtn").innerText = isSleeping ? "‚òÄÔ∏è Wake" : "üåô Sleep";

      if (isSleeping) {
        sleepTimer = setInterval(() => {
          currentPet.stats.energy = Math.min(100, currentPet.stats.energy + 8);
          spawnEffect("üí§");
          updateStatsUI();
        }, 3000);
      } else {
        clearInterval(sleepTimer);
        saveToFirebase();
      }
    }

    async function saveToFirebase() {
      await db.collection("pets").doc(currentPet.id).update({
        stats: currentPet.stats,
        lastUpdated: Date.now()
      });
      updateStatsUI();
    }

    function spawnEffect(text) {
      const p = document.createElement("div");
      p.className = "particle";
      p.innerText = text;
      p.style.left = "50%";
      p.style.bottom = "40%";
      document.body.appendChild(p);
      setTimeout(() => p.remove(), 1500);
    }

    async function createPet() {
      const name = document.getElementById("petName").value;
      const species = document.getElementById("petSpecies").value;
      if (!name) return alert("Enter a name!");
      const pet = {
        name, species, 
        stats: { hunger: 50, energy: 50, health: 100 },
        lastUpdated: Date.now()
      };
      const ref = await db.collection("pets").add(pet);
      displayPet({ id: ref.id, ...pet });
    }

    fetchPets();
  </script>
</body>
</html>
